library(magrittr)
library(ready4)
ready4fun::write_fn_type_dirs()
# MANUAL STEP. Write all your functions to R files in the new "fns" directory.
fns_env_ls <- ready4fun::read_fns(c("data-raw/fns/","data-raw/mthds/"),
                                  fns_env = new.env(parent = globalenv()))
x_ready4fun_manifest <- ready4fun::make_pkg_desc_ls(pkg_title_1L_chr = "Youth Outcomes to Health Utility",
                                                    pkg_desc_1L_chr = "Tools for mapping measures routinely collected in youth mental health services to Quality Adjusted Life Years (QALYs). Part of the First Bounce model of primary youth mental health services.
  This development version of the youthu package has been made available as part of the process of testing and documenting the package. If you have any questions, please contact the authors (matthew.hamilton@orygen.org.au).
  The documentation for this package has been automatically generated by the ready4fun package and is therefore quite rudimentary. Further human authored documentation will follow in 2021.",
                                                    authors_prsn = c(utils::person(given = "Matthew",family = "Hamilton",email = "matthew.hamilton@orygen.org.au", role = c("aut", "cre"),comment = c(ORCID = "0000-0001-7407-9194")),
                                                                     utils::person(given = "Caroline",family = "Gao",email = "caroline.gao@orygen.org.au", role = c("aut"),comment = c(ORCID = "0000-0002-0987-2759")),
                                                                     utils::person("Orygen", role = c("cph", "fnd")),
                                                                     utils::person("Headspace", role = c( "fnd")),
                                                                     utils::person("National Health and Medical Research Council", role = c( "fnd"))),
                                                    urls_chr = c("https://ready4-dev.github.io/youthu/",
                                                                 "https://github.com/ready4-dev/youthu",
                                                                 "https://www.ready4-dev.com/")) %>%
  ready4fun::make_manifest(addl_pkgs_ls = ready4fun::make_addl_pkgs_ls(#depends_chr = c("eq5d","ggfortify"),
                                                                       suggests_chr = c("knitr","rmarkdown"),
                                                                       #imports_chr = c("betareg","knitrBootstrap")
                                                                       ),
                           build_ignore_ls = ready4fun::make_build_ignore_ls(file_nms_chr = c("initial_setup.R")),
                           check_type_1L_chr = "ready4",
                           copyright_holders_chr = "Orygen",
                           custom_dmt_ls = ready4fun::make_custom_dmt_ls(user_manual_fns_chr = c("add_utl_predn",
                                                                                                 "add_qalys_to_ds",
                                                                                                 "get_mdl_from_dv",
                                                                                                 "get_mdls_using_predrs",
                                                                                                 "get_tfmn_from_lup",
                                                                                                 "make_hlth_ec_smry",
                                                                                                 "make_sngl_grp_ds",
                                                                                                 "make_matched_ds",
                                                                                                 "rename_from_nmd_vec")),##
                           dev_pkgs_chr = c("ready4","ready4fun",
                                            "ready4use","ready4show",
                                            "youthvars", "TTU"),
                           lifecycle_stage_1L_chr = "experimental",
                           path_to_pkg_logo_1L_chr = "../../../../../Documentation/Images/youthu-logo/default.png",
                           pkg_dmt_dv_dss_chr = c("https://doi.org/10.7910/DVN/HLLXZN",
                                                  "https://doi.org/10.7910/DVN/2Y9VF9"),
                           ready4_type_1L_chr = "authoring")
mdl_ingredients_ls <- ready4fun::get_rds_from_dv("mdl_ingredients",
                                           dv_ds_nm_1L_chr = "https://doi.org/10.7910/DVN/DKDIB0")
  # mdls_smry_tb <-ready4use::ready4use_dataverses() %>%
  # tibble::add_case(data_repo_db_ui_chr = "https://doi.org/10.7910/DVN/DKDIB0", # NOT UP TO DATE
  #                  file_name_chr = "mdls_smry_tb",
  #                  file_type_chr = ".csv",
  #                  data_repo_file_ext_chr = ".tab") %>%
  # ready4::procure()
mdl_ingredients_ls$mdls_lup
# utils::data("predictors_lup", package = "youthvars")
datasets_ls <- list(
  mdl_ingredients_ls$mdls_lup %>%
  # tibble::tibble(mdl_nms_chr = mdls_smry_tb$Model %>% unique()) %>%
  #                     dplyr::mutate(predrs_ls = mdl_nms_chr %>% strsplit("_") %>% purrr::map(~ .x[.x %in% c(predictors_lup$short_name_chr)]),
  #                                   mdl_type_chr = mdl_nms_chr %>% strsplit("_") %>% purrr::map(~ .x[.x %in% c("GLM", "OLS")]) %>% purrr::flatten_chr(),
  #                                   tfmn_chr = mdl_nms_chr %>% purrr::map_chr(~stringr::str_sub(.x,start = 1 +  stringi::stri_locate_last(.x,fixed = "_")[1,1] %>% as.vector())))  %>%
                      ready4fun::make_pkg_ds_ls(db_1L_chr = "mdls_lup",
                                                  title_1L_chr = "Lookup table of prediction models",
                                                  desc_1L_chr = "A summary of the key descriptive features of the prediction models included in the youthu package."))
x_ready4use_manifest <- ready4use::make_pt_ready4use_manifest(x_ready4fun_manifest,
                                                              #constructor_r3 = x_ready4class_constructor,
                                                              pkg_ds_ls_ls = datasets_ls) %>%
  ready4use::ready4use_manifest() # Need to rebuild
x_xx <- ready4::author(x_ready4use_manifest)






##


# 7. Save copy of package documentation to online data repo.
# ds_ls <- ready4use::write_pkg_dss_to_dv_ds_csvs(pkg_dss_tb,
#                                                 dv_nm_1L_chr = "ready4models",
#                                                 ds_url_1L_chr = "https://doi.org/10.7910/DVN/RXGPAT",
#                                                 parent_dv_dir_1L_chr = "../../../../../Data/Dataverse",
#                                                 wait_time_in_secs_int = 5L)
# NOTE: NEED TO UPDATE DIR PATH FOR MODELS
## Note files to be rewritten cannot be open in RStudio.
## 8. Document functions.
usethis::use_build_ignore("initial_setup.R")
usethis::use_package("knitrBootstrap")
usethis::use_package("truncnorm")
usethis::use_package("rmarkdown",type = "Suggests")
usethis::use_dev_package("ready4show")
usethis::use_dev_package("ready4use")
usethis::use_dev_package("youthvars")
usethis::use_dev_package("TTU")
readLines(".github/workflows/R-CMD-check.yaml")[-28] %>%
  writeLines(".github/workflows/R-CMD-check.yaml")
ready4fun::write_and_doc_fn_fls(fns_dmt_tb,
                                r_dir_1L_chr = "R",
                                dev_pkgs_chr = c("ready4fun","ready4show","ready4use","youthvars","TTU","dataverse"),
                                update_pkgdown_1L_lgl = T,
                                path_to_dvpr_dmt_dir_1L_chr = "../../../../../Documentation/Code/Developer",
                                path_to_user_dmt_dir_1L_chr = "../../../../../Documentation/Code/User")
# PAUSE FOR INTERACTIVE
# PART FOUR
# data("prototype_lup")
# if(!identical(prototype_lup,ready4fun::get_rds_from_dv("prototype_lup"))){
#   prototype_lup %>%
#     ready4use::write_paired_ds_fls_to_dv(fl_nm_1L_chr = "prototype_lup",
#                                          desc_1L_chr = "Prototypes lookup table")
# }
# devtools::build_vignettes()
#
ready4fun::write_links_for_website(user_manual_url_1L_chr = "https://github.com/ready4-dev/youthu/files/6950014/youthu_0.0.0.9095_user.pdf",
                                   developer_manual_url_1L_chr = "https://github.com/ready4-dev/youthu/files/6950013/youthu_0.0.0.9095_developer.pdf",
                                   project_website_url_1L_chr = "https://www.ready4-dev.com/")
#


