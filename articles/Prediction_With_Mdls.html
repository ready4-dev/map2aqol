<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="youthu">
<title>Predict Quality Adjusted Life Years (QALYs) • youthu</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<meta property="og:title" content="Predict Quality Adjusted Life Years (QALYs)">
<meta property="og:description" content="youthu">
<meta property="og:image" content="https://ready4-dev.github.io/youthu/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">youthu</a>

    <small class="nav-text text-danger me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="Unreleased version">0.0.0.9116</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../articles/youthu.html">Get started</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/Economic_Analysis.html">Economic analysis</a>
    <a class="dropdown-item" href="../articles/Prediction_With_Mdls.html">Predict Quality Adjusted Life Years (QALYs)</a>
    <a class="dropdown-item" href="../articles/V_01.html">Significant Changes To The Youthu Package</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav">
<li class="nav-item">
  <a class="external-link nav-link" href="https://github.com/ready4-dev/youthu/" aria-label="github">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>

    
  </div>
</nav><div class="container template-article">



<script src="Prediction_With_Mdls_files/kePrint-0.0.1/kePrint.js"></script><link href="Prediction_With_Mdls_files/lightable-0.0.1/lightable.css" rel="stylesheet">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Predict Quality Adjusted Life Years (QALYs)</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/ready4-dev/youthu/blob/HEAD/vignettes/Prediction_With_Mdls.Rmd" class="external-link"><code>vignettes/Prediction_With_Mdls.Rmd</code></a></small>
      <div class="d-none name"><code>Prediction_With_Mdls.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ready4-dev.github.io/youthu/">youthu</a></span><span class="op">)</span></span></code></pre></div>
<p>This vignette outlines a workflow for:</p>
<ul>
<li>Searching, selecting and retrieving transfer to utility models;</li>
<li>Preparing a prediction dataset for use with a selected transfer to
utility model; and</li>
<li>Applying the selected transfer to utility model to a prediction
dataset to predict Quality Adjusted Life Years (QALYs).</li>
</ul>
<p>The practical value of implementing such a workflow is discussed in
the <a href="https://ready4-dev.github.io/youthu/articles/Economic_Analysis.html">economic
analysis vignette</a> and <a href="https://www.medrxiv.org/content/10.1101/2021.07.07.21260129v2.full" class="external-link">a
scientific manuscript</a>. Note, this example uses fake data - it should
should not be used to inform decision making.</p>
<div class="section level2">
<h2 id="search-select-and-retrieve-transfer-to-utility-models">Search, select and retrieve transfer to utility models<a class="anchor" aria-label="anchor" href="#search-select-and-retrieve-transfer-to-utility-models"></a>
</h2>
<p>To identify datasets that contain transfer to utility models
compatible with youthu (ie those developped with the <a href="https://ready4-dev.github.io/TTU/index.html" class="external-link">TTU package</a>), you
can use the <code>get_ttu_dv_dss</code> function. The function searches
specified dataverses (in the below example, the <a href="https://dataverse.harvard.edu/dataverse/TTU" class="external-link">TTU dataverse</a>)
for datasets containing output from the TTU package.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ttu_dv_dss_tb</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_ttu_dv_dss.html">get_ttu_dv_dss</a></span><span class="op">(</span><span class="st">"TTU"</span><span class="op">)</span></span></code></pre></div>
<p>The <code>ttu_dv_dss_tb</code> table summarises some pertinent
details about each dataset containing TTU models found by the preceding
command. These details include a link to any scientific summary (the
“Article” column) associated with a dataset.</p>
<div style="border: 1px solid #ddd; padding: 5px; overflow-x: scroll; width:100%; ">
<table class="table  lightable-paper lightable-hover lightable-paper" style='font-family: "Arial Narrow", arial, helvetica, sans-serif; width: auto !important; margin-left: auto; margin-right: auto;border-bottom: 0; font-family: "Arial Narrow", arial, helvetica, sans-serif; margin-left: auto; margin-right: auto;'>
<caption>
Transfer to Utility Datasets
</caption>
<thead><tr>
<th style="text-align:left;">
ID
</th>
<th style="text-align:left;">
Utility
</th>
<th style="text-align:left;">
Predictors
</th>
<th style="text-align:left;">
Article
</th>
</tr></thead>
<tbody><tr>
<td style="text-align:left;">
1
</td>
<td style="text-align:left;">
aqol6dtotalw
</td>
<td style="text-align:left;">
BADS total score , GAD7 total score , K6 total score , OASIS total score
, PHQ9 total score , SCARED total score, SOFAS total score
</td>
<td style="text-align:left;">
<a href="https://doi.org/10.1101/2021.07.07.21260129" class="external-link uri">https://doi.org/10.1101/2021.07.07.21260129</a>
</td>
</tr></tbody>
<tfoot><tr>
<td style="padding: 0; " colspan="100%">
<sup></sup>
</td>
</tr></tfoot>
</table>
</div>
<p>To identify models that predict a specified type of health utility
from one or more of a specified subset of predictors, use:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">mdls_lup</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_mdls_lup.html">get_mdls_lup</a></span><span class="op">(</span>ttu_dv_dss_tb <span class="op">=</span> <span class="va">ttu_dv_dss_tb</span>,</span>
<span>                         utility_type_chr <span class="op">=</span> <span class="st">"AQoL-6D"</span>,</span>
<span>                         mdl_predrs_in_ds_chr <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"PHQ9 total score"</span>,</span>
<span>                                                  <span class="st">"SOFAS total score"</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>The preceding command will produce a lookup table with information
that includes the catalogue names of models, the predictors used in each
model and the analysis that generated each one.</p>
<div style="border: 1px solid #ddd; padding: 5px; overflow-x: scroll; width:100%; ">
<table class="table  lightable-paper lightable-hover lightable-paper" style='font-family: "Arial Narrow", arial, helvetica, sans-serif; width: auto !important; margin-left: auto; margin-right: auto;border-bottom: 0; font-family: "Arial Narrow", arial, helvetica, sans-serif; margin-left: auto; margin-right: auto;'>
<caption>
Selected elements from Models Look-Up Table
</caption>
<thead><tr>
<th style="text-align:left;">
Catalogue reference
</th>
<th style="text-align:right;">
Predictors
</th>
<th style="text-align:right;">
Analysis
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;">
PHQ9_1_GLM_GSN_LOG
</td>
<td style="text-align:right;">
PHQ9
</td>
<td style="text-align:right;">
Primary Analysis
</td>
</tr>
<tr>
<td style="text-align:left;">
PHQ9_1_OLS_CLL
</td>
<td style="text-align:right;">
PHQ9
</td>
<td style="text-align:right;">
Primary Analysis
</td>
</tr>
<tr>
<td style="text-align:left;">
PHQ9_SOFAS_1_GLM_GSN_LOG
</td>
<td style="text-align:right;">
PHQ9 , SOFAS
</td>
<td style="text-align:right;">
Primary Analysis
</td>
</tr>
<tr>
<td style="text-align:left;">
PHQ9_SOFAS_1_OLS_CLL
</td>
<td style="text-align:right;">
PHQ9 , SOFAS
</td>
<td style="text-align:right;">
Primary Analysis
</td>
</tr>
<tr>
<td style="text-align:left;">
OASIS_SOFAS_1_GLM_GSN_LOG
</td>
<td style="text-align:right;">
OASIS, SOFAS
</td>
<td style="text-align:right;">
Primary Analysis
</td>
</tr>
<tr>
<td style="text-align:left;">
OASIS_SOFAS_1_OLS_CLL
</td>
<td style="text-align:right;">
OASIS, SOFAS
</td>
<td style="text-align:right;">
Primary Analysis
</td>
</tr>
<tr>
<td style="text-align:left;">
BADS_SOFAS_1_GLM_GSN_LOG
</td>
<td style="text-align:right;">
BADS , SOFAS
</td>
<td style="text-align:right;">
Primary Analysis
</td>
</tr>
<tr>
<td style="text-align:left;">
BADS_SOFAS_1_OLS_CLL
</td>
<td style="text-align:right;">
BADS , SOFAS
</td>
<td style="text-align:right;">
Primary Analysis
</td>
</tr>
<tr>
<td style="text-align:left;">
K6_SOFAS_1_GLM_GSN_LOG
</td>
<td style="text-align:right;">
K6 , SOFAS
</td>
<td style="text-align:right;">
Primary Analysis
</td>
</tr>
<tr>
<td style="text-align:left;">
K6_SOFAS_1_OLS_CLL
</td>
<td style="text-align:right;">
K6 , SOFAS
</td>
<td style="text-align:right;">
Primary Analysis
</td>
</tr>
<tr>
<td style="text-align:left;">
SCARED_SOFAS_1_GLM_GSN_LOG
</td>
<td style="text-align:right;">
SCARED, SOFAS
</td>
<td style="text-align:right;">
Primary Analysis
</td>
</tr>
<tr>
<td style="text-align:left;">
SCARED_SOFAS_1_OLS_CLL
</td>
<td style="text-align:right;">
SCARED, SOFAS
</td>
<td style="text-align:right;">
Primary Analysis
</td>
</tr>
<tr>
<td style="text-align:left;">
GAD7_SOFAS_1_GLM_GSN_LOG
</td>
<td style="text-align:right;">
GAD7 , SOFAS
</td>
<td style="text-align:right;">
Primary Analysis
</td>
</tr>
<tr>
<td style="text-align:left;">
GAD7_SOFAS_1_OLS_CLL
</td>
<td style="text-align:right;">
GAD7 , SOFAS
</td>
<td style="text-align:right;">
Primary Analysis
</td>
</tr>
<tr>
<td style="text-align:left;">
SOFAS_1_GLM_GSN_LOG
</td>
<td style="text-align:right;">
SOFAS
</td>
<td style="text-align:right;">
Secondary Analysis A
</td>
</tr>
<tr>
<td style="text-align:left;">
SOFAS_1_OLS_CLL
</td>
<td style="text-align:right;">
SOFAS
</td>
<td style="text-align:right;">
Secondary Analysis A
</td>
</tr>
<tr>
<td style="text-align:left;">
OASIS_PHQ9_1_GLM_GSN_LOG
</td>
<td style="text-align:right;">
OASIS, PHQ9
</td>
<td style="text-align:right;">
Secondary Analysis B
</td>
</tr>
<tr>
<td style="text-align:left;">
OASIS_PHQ9_1_OLS_CLL
</td>
<td style="text-align:right;">
OASIS, PHQ9
</td>
<td style="text-align:right;">
Secondary Analysis B
</td>
</tr>
<tr>
<td style="text-align:left;">
GAD7_PHQ9_1_GLM_GSN_LOG
</td>
<td style="text-align:right;">
GAD7, PHQ9
</td>
<td style="text-align:right;">
Secondary Analysis B
</td>
</tr>
<tr>
<td style="text-align:left;">
GAD7_PHQ9_1_OLS_CLL
</td>
<td style="text-align:right;">
GAD7, PHQ9
</td>
<td style="text-align:right;">
Secondary Analysis B
</td>
</tr>
<tr>
<td style="text-align:left;">
SCARED_PHQ9_1_GLM_GSN_LOG
</td>
<td style="text-align:right;">
SCARED, PHQ9
</td>
<td style="text-align:right;">
Secondary Analysis B
</td>
</tr>
<tr>
<td style="text-align:left;">
SCARED_PHQ9_1_OLS_CLL
</td>
<td style="text-align:right;">
SCARED, PHQ9
</td>
<td style="text-align:right;">
Secondary Analysis B
</td>
</tr>
</tbody>
<tfoot><tr>
<td style="padding: 0; " colspan="100%">
<sup></sup>
</td>
</tr></tfoot>
</table>
</div>
<p>To review the summary information about the predictive performance of
a specific model, use:</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/get_dv_mdl_smrys.html">get_dv_mdl_smrys</a></span><span class="op">(</span><span class="va">mdls_lup</span>,</span>
<span>                 mdl_nms_chr <span class="op">=</span> <span class="st">"PHQ9_SOFAS_1_OLS_CLL"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## $PHQ9_SOFAS_1_OLS_CLL</span></span>
<span><span class="co">##        Parameter Estimate    SE          95% CI</span></span>
<span><span class="co">## 1 SD (Intercept)    0.348 0.017   0.312 , 0.382</span></span>
<span><span class="co">## 2      Intercept    0.428 0.129   0.174 , 0.686</span></span>
<span><span class="co">## 3  PHQ9 baseline   -9.115 0.249 -9.601 , -8.618</span></span>
<span><span class="co">## 4    PHQ9 change   -7.331 0.339 -8.007 , -6.665</span></span>
<span><span class="co">## 5 SOFAS baseline    0.960 0.172   0.616 , 1.292</span></span>
<span><span class="co">## 6   SOFAS change    1.146 0.235   0.674 , 1.607</span></span>
<span><span class="co">## 7             R2    0.767 0.012   0.743 , 0.788</span></span>
<span><span class="co">## 8           RMSE    0.925 0.004   0.922 , 0.928</span></span>
<span><span class="co">## 9          Sigma    0.406 0.012   0.384 , 0.429</span></span></code></pre>
<p>More information about a selected model can be found in the online
model catalogue, the link to which can be obtained with the following
command:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="../reference/get_mdl_ctlg_url.html">get_mdl_ctlg_url</a></span><span class="op">(</span><span class="va">mdls_lup</span>,</span>
<span>                 mdl_nm_1L_chr <span class="op">=</span> <span class="st">"PHQ9_SOFAS_1_OLS_CLL"</span><span class="op">)</span></span></code></pre></div>
<p>[1] “<a href="https://dataverse.harvard.edu/api/access/datafile/6484935" class="external-link uri">https://dataverse.harvard.edu/api/access/datafile/6484935</a>”</p>
</div>
<div class="section level2">
<h2 id="prepare-a-prediction-dataset-for-use-with-a-selected-transfer-to-utility-model">Prepare a prediction dataset for use with a selected transfer to
utility model<a class="anchor" aria-label="anchor" href="#prepare-a-prediction-dataset-for-use-with-a-selected-transfer-to-utility-model"></a>
</h2>
<div class="section level3">
<h3 id="import-data">Import data<a class="anchor" aria-label="anchor" href="#import-data"></a>
</h3>
<p>You can now import and inspect the dataset you plan on using for
prediction. In the below example we use fake data.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data_tb</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/make_fake_ds_one.html">make_fake_ds_one</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<div style="border: 1px solid #ddd; padding: 5px; overflow-x: scroll; width:100%; ">
<table class="table  lightable-paper lightable-hover lightable-paper" style='font-family: "Arial Narrow", arial, helvetica, sans-serif; width: auto !important; margin-left: auto; margin-right: auto;border-bottom: 0; font-family: "Arial Narrow", arial, helvetica, sans-serif; margin-left: auto; margin-right: auto;'>
<caption>
Illustrative example of a prediction dataset
</caption>
<thead><tr>
<th style="text-align:left;">
UID
</th>
<th style="text-align:right;">
Timepoint
</th>
<th style="text-align:right;">
Date
</th>
<th style="text-align:right;">
PHQ_total
</th>
<th style="text-align:right;">
SOFAS_total
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;">
Participant_1
</td>
<td style="text-align:right;">
Baseline
</td>
<td style="text-align:right;">
2021-09-20
</td>
<td style="text-align:right;">
7
</td>
<td style="text-align:right;">
69
</td>
</tr>
<tr>
<td style="text-align:left;">
Participant_10
</td>
<td style="text-align:right;">
Baseline
</td>
<td style="text-align:right;">
2021-08-18
</td>
<td style="text-align:right;">
17
</td>
<td style="text-align:right;">
60
</td>
</tr>
<tr>
<td style="text-align:left;">
Participant_10
</td>
<td style="text-align:right;">
Follow-up
</td>
<td style="text-align:right;">
2021-11-02
</td>
<td style="text-align:right;">
17
</td>
<td style="text-align:right;">
64
</td>
</tr>
<tr>
<td style="text-align:left;">
Participant_100
</td>
<td style="text-align:right;">
Baseline
</td>
<td style="text-align:right;">
2021-05-09
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
76
</td>
</tr>
<tr>
<td style="text-align:left;">
Participant_1000
</td>
<td style="text-align:right;">
Baseline
</td>
<td style="text-align:right;">
2021-07-18
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
71
</td>
</tr>
<tr>
<td style="text-align:left;">
Participant_1000
</td>
<td style="text-align:right;">
Follow-up
</td>
<td style="text-align:right;">
2021-10-13
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
71
</td>
</tr>
</tbody>
<tfoot><tr>
<td style="padding: 0; " colspan="100%">
<sup></sup>
</td>
</tr></tfoot>
</table>
</div>
</div>
<div class="section level3">
<h3 id="confirm-dataset-can-be-used-as-a-prediction-dataset">Confirm dataset can be used as a prediction dataset<a class="anchor" aria-label="anchor" href="#confirm-dataset-can-be-used-as-a-prediction-dataset"></a>
</h3>
<p>The prediction dataset must contain variables that correspond to all
the predictors of the model you intend to apply. The allowable range and
required class of each predictor variable are described in the
<code>min_val_dbl</code>, <code>max_val_dbl</code> and
<code>class_chr</code> columns of the model predictors lookup table,
which can be accessed with a call to the <code>get_predictors_lup</code>
function.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">predictors_lup</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_predictors_lup.html">get_predictors_lup</a></span><span class="op">(</span>mdls_lup <span class="op">=</span> <span class="va">mdls_lup</span>,</span>
<span>                                     mdl_nm_1L_chr <span class="op">=</span> <span class="st">"PHQ9_SOFAS_1_OLS_CLL"</span><span class="op">)</span></span></code></pre></div>
<div style="border: 1px solid #ddd; padding: 5px; overflow-x: scroll; width:100%; ">
<table class="table  lightable-paper lightable-hover lightable-paper" style='font-family: "Arial Narrow", arial, helvetica, sans-serif; width: auto !important; margin-left: auto; margin-right: auto;border-bottom: 0; font-family: "Arial Narrow", arial, helvetica, sans-serif; margin-left: auto; margin-right: auto;'>
<caption>
Model predictors lookup table
</caption>
<thead><tr>
<th style="text-align:left;">
short_name_chr
</th>
<th style="text-align:right;">
long_name_chr
</th>
<th style="text-align:left;">
min_val_dbl
</th>
<th style="text-align:right;">
max_val_dbl
</th>
<th style="text-align:left;">
class_chr
</th>
<th style="text-align:right;">
increment_dbl
</th>
<th style="text-align:left;">
class_fn_chr
</th>
<th style="text-align:right;">
mdl_scaling_dbl
</th>
<th style="text-align:left;">
covariate_lgl
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;">
PHQ9
</td>
<td style="text-align:right;">
PHQ9 total score
</td>
<td style="text-align:left;">
0
</td>
<td style="text-align:right;">
27
</td>
<td style="text-align:left;">
integer
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
youthvars::youthvars_phq9
</td>
<td style="text-align:right;">
0.01
</td>
<td style="text-align:left;">
FALSE
</td>
</tr>
<tr>
<td style="text-align:left;">
SOFAS
</td>
<td style="text-align:right;">
SOFAS total score
</td>
<td style="text-align:left;">
0
</td>
<td style="text-align:right;">
100
</td>
<td style="text-align:left;">
integer
</td>
<td style="text-align:right;">
1
</td>
<td style="text-align:left;">
youthvars::youthvars_sofas
</td>
<td style="text-align:right;">
0.01
</td>
<td style="text-align:left;">
TRUE
</td>
</tr>
</tbody>
<tfoot><tr>
<td style="padding: 0; " colspan="100%">
<sup></sup>
</td>
</tr></tfoot>
</table>
</div>
<p>The prediction dataset must also include both a unique client
identifier variable and a measurement time-point identifier variable
(which must be a <code class="sourceCode r">factor</code> with two
levels). The dataset also needs to be in long format (ie where measures
at different time-points for the same individual are stacked on top of
each other in separate rows). We can confirm these conditions hold by
creating a dataset metadata object using the
<code>make_predn_metadata_ls</code> function. In creating the metadata
object, the function checks that the dataset can be used in conjunction
with the model specified at the <code>mdl_nm_1L_chr</code> argument. If
the prediction dataset uses different variable names for the predictors
to those specified in the <code class="sourceCode r">predictors_lup</code> lookup table, a named vector
detailing the correspondence between the two sets of variable names
needs to be passed to the <code>predr_vars_nms_chr</code> argument.
Finally, if you wish to specify a preferred variable name to use for the
predicted utility values when applying the model, you can do this by
passing this name to the <code>utl_var_nm_1L_chr</code> argument.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">predn_ds_ls</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/make_predn_metadata_ls.html">make_predn_metadata_ls</a></span><span class="op">(</span><span class="va">data_tb</span>,</span>
<span>                                      id_var_nm_1L_chr <span class="op">=</span> <span class="st">"UID"</span>,</span>
<span>                                      msrmnt_date_var_nm_1L_chr <span class="op">=</span> <span class="st">"Date"</span>,</span>
<span>                                      predr_vars_nms_chr <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>PHQ9 <span class="op">=</span> <span class="st">"PHQ_total"</span>,SOFAS <span class="op">=</span> <span class="st">"SOFAS_total"</span><span class="op">)</span>,</span>
<span>                                      round_var_nm_1L_chr <span class="op">=</span> <span class="st">"Timepoint"</span>,</span>
<span>                                      round_bl_val_1L_chr <span class="op">=</span> <span class="st">"Baseline"</span>,</span>
<span>                                      utl_var_nm_1L_chr <span class="op">=</span> <span class="st">"AQoL6D_HU"</span>,</span>
<span>                                      mdls_lup <span class="op">=</span> <span class="va">mdls_lup</span>,</span>
<span>                                      mdl_nm_1L_chr <span class="op">=</span> <span class="st">"PHQ9_SOFAS_1_OLS_CLL"</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="apply-the-selected-transfer-to-utility-model-to-a-prediction-dataset-to-predict-quality-adjusted-life-years-qalys">Apply the selected transfer to utility model to a prediction dataset
to predict Quality Adjusted Life Years (QALYs)<a class="anchor" aria-label="anchor" href="#apply-the-selected-transfer-to-utility-model-to-a-prediction-dataset-to-predict-quality-adjusted-life-years-qalys"></a>
</h2>
<div class="section level3">
<h3 id="predict-health-utility-at-baseline-and-follow-up-timepoints">Predict health utility at baseline and follow-up timepoints<a class="anchor" aria-label="anchor" href="#predict-health-utility-at-baseline-and-follow-up-timepoints"></a>
</h3>
<p>To generate utility predictions we use the <code class="sourceCode r">add_utl_predn</code> function. The function needs
to be supplied with the prediction dataset (the value passed to argument
<code>data_tb</code>) and the validated prediction metadata object we
created in the previous step.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data_tb</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/add_utl_predn.html">add_utl_predn</a></span><span class="op">(</span><span class="va">data_tb</span>,</span>
<span>                         predn_ds_ls <span class="op">=</span> <span class="va">predn_ds_ls</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Joining with `by = join_by(UID, Timepoint)`</span></span></code></pre>
<p>By default the <code class="sourceCode r">add_utl_predn</code>
function samples model parameter values based on a table of model
coefficients when making predictions and constrains predictions to an
allowed range. You can override these defaults by adding additional
arguments <code>new_data_is_1L_chr = "Predicted"</code> (which uses mean
parameter values), <code>force_min_max_1L_lgl = F</code> (removes range
constraint) and (if the source dataset makes available downloadable
model objects) <code>make_from_tbl_1L_lgl = F</code>. These settings
will produce different predictions. It is strongly recommended that you
consult the model catalogue (see above) to understand how such decisions
may affect the validity of the predicted values that will be
generated.</p>
<div style="border: 1px solid #ddd; padding: 5px; overflow-x: scroll; width:100%; ">
<table class="table  lightable-paper lightable-hover lightable-paper" style='font-family: "Arial Narrow", arial, helvetica, sans-serif; width: auto !important; margin-left: auto; margin-right: auto;border-bottom: 0; font-family: "Arial Narrow", arial, helvetica, sans-serif; margin-left: auto; margin-right: auto;'>
<caption>
Prediction dataset with predicted utilities
</caption>
<thead><tr>
<th style="text-align:left;">
UID
</th>
<th style="text-align:right;">
Timepoint
</th>
<th style="text-align:right;">
Date
</th>
<th style="text-align:right;">
PHQ_total
</th>
<th style="text-align:right;">
SOFAS_total
</th>
<th style="text-align:right;">
AQoL6D_HU
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;">
Participant_1
</td>
<td style="text-align:right;">
Baseline
</td>
<td style="text-align:right;">
2021-09-20
</td>
<td style="text-align:right;">
7
</td>
<td style="text-align:right;">
69
</td>
<td style="text-align:right;">
0.8331776
</td>
</tr>
<tr>
<td style="text-align:left;">
Participant_10
</td>
<td style="text-align:right;">
Baseline
</td>
<td style="text-align:right;">
2021-08-18
</td>
<td style="text-align:right;">
17
</td>
<td style="text-align:right;">
60
</td>
<td style="text-align:right;">
0.3050778
</td>
</tr>
<tr>
<td style="text-align:left;">
Participant_10
</td>
<td style="text-align:right;">
Follow-up
</td>
<td style="text-align:right;">
2021-11-02
</td>
<td style="text-align:right;">
17
</td>
<td style="text-align:right;">
64
</td>
<td style="text-align:right;">
0.6704479
</td>
</tr>
<tr>
<td style="text-align:left;">
Participant_100
</td>
<td style="text-align:right;">
Baseline
</td>
<td style="text-align:right;">
2021-05-09
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
76
</td>
<td style="text-align:right;">
0.9991066
</td>
</tr>
<tr>
<td style="text-align:left;">
Participant_1000
</td>
<td style="text-align:right;">
Baseline
</td>
<td style="text-align:right;">
2021-07-18
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
71
</td>
<td style="text-align:right;">
0.9253631
</td>
</tr>
<tr>
<td style="text-align:left;">
Participant_1000
</td>
<td style="text-align:right;">
Follow-up
</td>
<td style="text-align:right;">
2021-10-13
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
71
</td>
<td style="text-align:right;">
0.7115511
</td>
</tr>
</tbody>
<tfoot><tr>
<td style="padding: 0; " colspan="100%">
<sup></sup>
</td>
</tr></tfoot>
</table>
</div>
<p>Our health utility predictions are now available for use and are
summarised below.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">data_tb</span><span class="op">$</span><span class="va">AQoL6D_HU</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##    Min. 1st Qu.  Median    Mean 3rd Qu.    Max. </span></span>
<span><span class="co">## 0.08548 0.42785 0.63780 0.62466 0.83318 0.99999</span></span></code></pre>
</div>
<div class="section level3">
<h3 id="calculate-qalys">Calculate QALYs<a class="anchor" aria-label="anchor" href="#calculate-qalys"></a>
</h3>
<p>The last step is to calculate Quality Adjusted Life Years, using a
method assuming a linear rate of change between timepoints.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data_tb</span> <span class="op">&lt;-</span> <span class="va">data_tb</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu"><a href="../reference/add_qalys_to_ds.html">add_qalys_to_ds</a></span><span class="op">(</span>predn_ds_ls <span class="op">=</span> <span class="va">predn_ds_ls</span>,</span>
<span>                                       include_predrs_1L_lgl <span class="op">=</span> <span class="cn">F</span>,</span>
<span>                                       reshape_1L_lgl <span class="op">=</span> <span class="cn">F</span><span class="op">)</span></span></code></pre></div>
<div style="border: 1px solid #ddd; padding: 5px; overflow-x: scroll; width:100%; ">
<table class="table  lightable-paper lightable-hover lightable-paper" style='font-family: "Arial Narrow", arial, helvetica, sans-serif; width: auto !important; margin-left: auto; margin-right: auto;border-bottom: 0; font-family: "Arial Narrow", arial, helvetica, sans-serif; margin-left: auto; margin-right: auto;'>
<caption>
Prediction dataset with QALYs
</caption>
<thead><tr>
<th style="text-align:left;">
UID
</th>
<th style="text-align:right;">
Timepoint
</th>
<th style="text-align:right;">
Date
</th>
<th style="text-align:right;">
PHQ_total
</th>
<th style="text-align:right;">
SOFAS_total
</th>
<th style="text-align:right;">
AQoL6D_HU
</th>
<th style="text-align:left;">
AQoL6D_HU_change_dbl
</th>
<th style="text-align:right;">
duration_prd
</th>
<th style="text-align:right;">
qalys_dbl
</th>
</tr></thead>
<tbody>
<tr>
<td style="text-align:left;">
Participant_1
</td>
<td style="text-align:right;">
Baseline
</td>
<td style="text-align:right;">
2021-09-20
</td>
<td style="text-align:right;">
7
</td>
<td style="text-align:right;">
69
</td>
<td style="text-align:right;">
0.8331776
</td>
<td style="text-align:left;">
0.0000000
</td>
<td style="text-align:right;">
0S
</td>
<td style="text-align:right;">
0.0000000
</td>
</tr>
<tr>
<td style="text-align:left;">
Participant_10
</td>
<td style="text-align:right;">
Baseline
</td>
<td style="text-align:right;">
2021-08-18
</td>
<td style="text-align:right;">
17
</td>
<td style="text-align:right;">
60
</td>
<td style="text-align:right;">
0.3050778
</td>
<td style="text-align:left;">
0.0000000
</td>
<td style="text-align:right;">
0S
</td>
<td style="text-align:right;">
0.0000000
</td>
</tr>
<tr>
<td style="text-align:left;">
Participant_10
</td>
<td style="text-align:right;">
Follow-up
</td>
<td style="text-align:right;">
2021-11-02
</td>
<td style="text-align:right;">
17
</td>
<td style="text-align:right;">
64
</td>
<td style="text-align:right;">
0.6704479
</td>
<td style="text-align:left;">
0.3653701
</td>
<td style="text-align:right;">
76d 0H 0M 0S
</td>
<td style="text-align:right;">
0.1014921
</td>
</tr>
<tr>
<td style="text-align:left;">
Participant_100
</td>
<td style="text-align:right;">
Baseline
</td>
<td style="text-align:right;">
2021-05-09
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
76
</td>
<td style="text-align:right;">
0.9991066
</td>
<td style="text-align:left;">
0.0000000
</td>
<td style="text-align:right;">
0S
</td>
<td style="text-align:right;">
0.0000000
</td>
</tr>
<tr>
<td style="text-align:left;">
Participant_1000
</td>
<td style="text-align:right;">
Baseline
</td>
<td style="text-align:right;">
2021-07-18
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
71
</td>
<td style="text-align:right;">
0.9253631
</td>
<td style="text-align:left;">
0.0000000
</td>
<td style="text-align:right;">
0S
</td>
<td style="text-align:right;">
0.0000000
</td>
</tr>
<tr>
<td style="text-align:left;">
Participant_1000
</td>
<td style="text-align:right;">
Follow-up
</td>
<td style="text-align:right;">
2021-10-13
</td>
<td style="text-align:right;">
0
</td>
<td style="text-align:right;">
71
</td>
<td style="text-align:right;">
0.7115511
</td>
<td style="text-align:left;">
-0.2138120
</td>
<td style="text-align:right;">
87d 0H 0M 0S
</td>
<td style="text-align:right;">
0.1949508
</td>
</tr>
</tbody>
<tfoot><tr>
<td style="padding: 0; " colspan="100%">
<sup></sup>
</td>
</tr></tfoot>
</table>
</div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Matthew Hamilton, Caroline Gao, Orygen, Headspace, National Health and Medical Research Council.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
